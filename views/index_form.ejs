<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Profile Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #ff7bbf;
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group input,
        textarea {
            width: 95%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-group .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .form-group .badges input {
            margin-right: 5px;
        }

        .form-group .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .form-group .options button {
            padding: 5px 10px;
            font-size: 14px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-group .options button.selected {
            background-color: #c91212;
            color: white;
            border-color: #4CAF50;
        }

        .form-group button[type="submit"] {
            display: block;
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background-color: black;
            color: rgba(255, 243, 243, 0.774);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-group button:hover {
            background-color: black;
            color: wheat;
        }
    </style>
</head>

<body>
    <div class="form-container">
        <!-- <h2>Create Your Profile</h2> -->
        <form id="profile-form" enctype="multipart/form-data">
            <div class="form-group" style="display: none;">
                <label for="profile-photo">Profile Photo:</label>
                <input type="file" id="profilePhoto" name="Photo" accept="image/*">
            </div>

            <div class="form-group">
                <label for="bio">Bio:</label>
                <textarea id="bio" name="bio" rows="5" placeholder="Write something about yourself..."
                    maxlength="500"></textarea>
            </div>

            <div class="form-group">
                <label for="country">Country:</label>
                <input type="text" id="country" name="country" placeholder="Enter your country" required>
            </div>
            <div class="form-group">
                <label>Interests:</label>
                <div class="options" id="interests-options">
                    <button type="button" data-value="Sports">Sports</button>
                    <button type="button" data-value="Music">Music</button>
                    <button type="button" data-value="Travel">Travel</button>
                    <button type="button" data-value="Reading">Reading</button>
                    <button type="button" data-value="Gaming">Gaming</button>
                    <button type="button" data-value="Technology">Technology</button>
                    <button type="button" data-value="Science">Science</button>
                    <button type="button" data-value="History">History</button>
                    <button type="button" data-value="Arts & Crafts">Arts & Crafts</button>
                    <button type="button" data-value="Astronomy">Astronomy</button>
                    <button type="button" data-value="Environmental Activism">Environmental Activism</button>
                    <button type="button" data-value="Fashion">Fashion</button>
                    <button type="button" data-value="Gardening">Gardening</button>
                    <button type="button" data-value="Health & Fitness">Health & Fitness</button>
                    <button type="button" data-value="Meditation">Meditation</button>
                    <button type="button" data-value="Photography">Photography</button>
                    <button type="button" data-value="Theater & Drama">Theater & Drama</button>
                    <button type="button" data-value="Social Media">Social Media</button>
                    <button type="button" data-value="Cooking">Cooking</button>
                    <button type="button" data-value="Exploring Cultures">Exploring Cultures</button>
                    <button type="button" data-value="Volunteering">Volunteering</button>
                </div>
            </div>

            <div class="form-group">
                <label>Hobbies:</label>
                <div class="options" id="hobbies-options">
                    <button type="button" data-value="Painting">Painting</button>
                    <button type="button" data-value="Dancing">Dancing</button>
                    <button type="button" data-value="Cooking">Cooking</button>
                    <button type="button" data-value="Photography">Photography</button>
                    <button type="button" data-value="Writing">Writing</button>
                    <button type="button" data-value="Drawing">Drawing</button>
                    <button type="button" data-value="Knitting">Knitting</button>
                    <button type="button" data-value="Woodworking">Woodworking</button>
                    <button type="button" data-value="DIY Projects">DIY Projects</button>
                    <button type="button" data-value="Hiking">Hiking</button>
                    <button type="button" data-value="Camping">Camping</button>
                    <button type="button" data-value="Birdwatching">Birdwatching</button>
                    <button type="button" data-value="Baking">Baking</button>
                    <button type="button" data-value="Sculpting">Sculpting</button>
                    <button type="button" data-value="Acting">Acting</button>
                    <button type="button" data-value="Playing Musical Instruments">Playing Musical Instruments</button>
                    <button type="button" data-value="Collecting">Collecting</button>
                    <button type="button" data-value="Video Editing">Video Editing</button>
                    <button type="button" data-value="Calligraphy">Calligraphy</button>
                    <button type="button" data-value="Fishing">Fishing</button>
                </div>
            </div>

            <div class="form-group">
                <label for="family-role">Family Role:</label>
                <select id="family-role" name="familyRole" required>
                    <option value="">Select your role</option>
                    <option value="Guardian">Guardian</option>
                    <option value="Explorer">Explorer</option>
                    <option value="Peacemaker">Peacemaker</option>
                </select>
            </div>
            <div class="form-group">
                <label>Badges/Levels:</label>
                <div class="badges">
                    <label><input type="checkbox" name="badges[]" value="Cultural Contributor"> Cultural
                        Contributor</label>
                    <label><input type="checkbox" name="badges[]" value="Eco Warrior"> Eco Warrior</label>
                    <label><input type="checkbox" name="badges[]" value="Tech Innovator"> Tech Innovator</label>
                    <label><input type="checkbox" name="badges[]" value="Community Helper"> Community Helper</label>
                </div>
            </div>
            <div class="form-group">
                <button type="submit">Submit Profile</button>
            </div>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // References to buttons and form elements
            const interestsButtons = document.querySelectorAll('#interests-options button');
            const hobbiesButtons = document.querySelectorAll('#hobbies-options button');
            const form = document.getElementById('profile-form');
            const submitButton = form.querySelector('button[type="submit"]');

            // Utility function to toggle the "selected" class
            function toggleSelection(event) {
                event.target.classList.toggle('selected');
            }

            // Attach click event listeners to hobby and interest buttons
            interestsButtons.forEach(button => button.addEventListener('click', toggleSelection));
            hobbiesButtons.forEach(button => button.addEventListener('click', toggleSelection));

            // Function to collect selected options
            function getSelectedOptions(buttons) {
                return Array.from(buttons)
                    .filter(button => button.classList.contains('selected'))
                    .map(button => button.getAttribute('data-value'));
            }

            // Form submission handler
            form.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent default form submission
                const profilePhotoInput = document.getElementById('profilePhoto');
                const profilePhoto = profilePhotoInput.files[0];

                // Collect data from the form
                const formData = new FormData(form);
                formData.append('profilePhoto', profilePhoto);
                const data = Object.fromEntries(formData.entries());


                // Add selected hobbies and interests
                data.interests = getSelectedOptions(interestsButtons);
                data.hobbies = getSelectedOptions(hobbiesButtons);
                console.log('hobboes', data.hobbies);

                // Validate required fields
                if (!data.bio?.trim() || !data.country?.trim() || !data.familyRole?.trim()) {
                    alert('Please fill out all required fields.');
                    return;
                }

                formData.append('hobbies', JSON.stringify(getSelectedOptions(hobbiesButtons)));
                formData.append('interests', JSON.stringify(getSelectedOptions(interestsButtons)));

                // Collect selected badges
                data.badges = formData.getAll('badges[]') || [];

                // Disable the submit button to prevent multiple submissions
                submitButton.disabled = true;

                try {
                    // Include JWT token if available
                    const jwt = localStorage.getItem('jwt');
                    if (!jwt) {
                        throw new Error('Token not found. Please log in.');
                    }

                    // Send data to the server
                    const response = await fetch('/submit-profile', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${jwt}`,

                        },
                        body: formData,
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert('Profile submitted successfully!');
                        console.log('Server response:', result);
                        form.reset(); // Clear the form
                    } else {
                        const error = await response.json();
                        console.error('Error submitting profile:', error.message || response.statusText);
                        alert(`Error: ${error.message || 'An unknown error occurred.'}`);
                    }
                } catch (error) {
                    console.error('Submission error:', error);
                    alert('An error occurred. Please try again.');
                } finally {
                    submitButton.disabled = false; // Re-enable the submit button
                }
            });
        });

    </script>
</body>

</html>